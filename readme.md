# Audio Processor

#### Тестовое задание для позиции ML-разработчик, в компании Колл-Тулз
#### Подготовил Фатихов Артур

Приложение для работы с аудиофайлами формата WAV, написанное на языке Python. Приложение предоставляет два основных функционала: модификацию аудиофайлов и их расшифровку в текстовый формат.

## Оглавление
1. Функции
   - Модификация аудиофайлов
   - Расшифровка аудио в текст
2. Интерфейс
3. Использование
   - Запуск сервиса
   - Тестирование
4. Краткое описание файлов в сервисе
5. Вывод

## Функции

### Модификация аудиофайлов
Функция позволяет изменять скорость и громкость аудиофайла. Пользователь может:

- Уменьшить или увеличить скорость воспроизведения.
- Изменить громкость аудио.

Для использования функции необходимо отправить POST-запрос к эндпоинту `/process_audio`:

params = {
    'speed': speed,   # Изменение скорости воспроизведения (от 0 до 1)
    'volume': volume  # Изменение громкости (от -45 до 45 дБ)
}

response = requests.post(
    url='http://127.0.0.1:8087/process_audio',
    files={'file': ('audio.wav', audio_file, 'audio/wav')},
    params=params
)


### Расшифровка аудио в текст

Эта функция использует open-source библиотеки для офлайн распознавания речи и преобразует аудиофайл в текст. Поддерживаются распознавание на русском и английском языках.

Для классификации языка используется библиотека speechbrain из https://github.com/speechbrain/speechbrain.
Для распознавания речи используются модели Vosk, доступные на сайте https://alphacephei.com/.

Для использования функции необходимо отправить POST-запрос к эндпоинту /recognize_speech:

files = {'file': audio_file}
response = requests.post("http://localhost:8087/recognize_speech", files=files)


## Интерфейс
Сервис предназначен для запуска в виде Docker-контейнера и требует минимального количества файлов. При запуске будут установлены все необходимые библиотеки и загружены требуемые модели.
Приложение предоставляет API для взаимодействия с пользователем через два эндпоинта:

/process_audio — для модификации аудиофайлов.
/recognize_speech — для распознавания речи.

## Использование
### Запуск сервиса
1. Приложение можно запустить двумя способами:

Перейдите в папку audio и выполните одну из следующих команд:

- Запуск сервиса с небольшими моделями для распознавания речи:
sudo docker compose up

- Запуск сервиса с большими моделями для распознавания речи:
sudo docker compose -f docker-compose_bigger_models.yml up

При запуске будет происходить сборка контейнера, загрузка необходимых моделей Vosk в папку api/models, а также установка необходимых библиотек.

### Тестирование
Для тестирования сервиса используйте файлы, находящиеся в папке audio/test:

### 1. Модификация аудиофайлов:
Файл processing_test.py предназначен для тестирования изменения громкости и скорости аудиофайла.
В разделе if __name__ == "__main__": можно задать путь к аудиофайлу формата WAV и параметры:

speed — во сколько раз изменить скорость воспроизведения.
volume — изменение громкости в децибелах.
Измененный аудиофайл по умолчанию сохраняется в папке api/test/processed_sounds. При необходимости путь можно изменить. Для запуска теста выполните команду:

python3 processing_test.py

При успешном выполнении теста вы увидите сообщение о сохранении измененного аудиофайла.

### 2. Расшифровка аудио в текст:
Файл speech_to_text_test.py предназначен для тестирования функции распознавания речи на русском и английском языках.
В разделе if __name__ == "__main__": укажите путь к аудиофайлу для распознавания и путь для сохранения текстового файла (по умолчанию сохраняется в api/test/speech_to_text).

Для запуска теста выполните команду:

python3 speech_to_text_test.py

При успешном выполнении теста будет выведена информация о языке распознанного текста, сам распознанный текст и путь сохранения текстового файла

## Краткое описание файлов в сервисе 

audio/
├── api
│   ├── Dockerfile # Dockerfile для сборки контейнера с маленькими моделями для распознавания речи.
│   ├── Dockerfile_bigger_models # Dockerfile для сборки контейнера с большими моделями для распознавания речи.
│   ├── download_and_unzip_bigger_models.sh # Скрипт для скачивания и распаковки больших моделей Vosk.
│   ├── download_and_unzip.sh # Скрипт для скачивания и распаковки маленьких моделей Vosk.
│   ├── __init__.py # Инициализационный файл Python пакета.
│   ├── main.py # Основной файл приложения с реализацией API для обработки аудио и распознавания речи.
│   └── requirements.txt # Список зависимостей Python, необходимых для работы приложения.
├── docker-compose_bigger_models.yml # Конфигурационный файл Docker Compose для запуска сервиса с большими моделями.
├── docker-compose.yml # Конфигурационный файл Docker Compose для запуска сервиса с маленькими моделями.
├── readme.md # Файл документации с описанием функционала и инструкциями по использованию.
└── test
    ├── original
    │   ├── 752362__josefpres__piano-loops-064-efect-3-octave-long-loop-120-bpm.wav # Пример аудиофайла для тестирования.
    │   ├── russian_speech.wav # Пример аудиофайла с русской речью для тестирования.
    │   └── speech.wav # Пример аудиофайла с английской речью для тестирования.
    ├── processed_sounds
    │   └── 752362__josefpres__piano-loops-064-efect-3-octave-long-loop-120-bpm_processed.wav # Обработанный аудиофайл, полученный после изменения скорости и громкости.
    ├── processing_test.py # Скрипт для тестирования функции изменения громкости и скорости аудиофайлов.
    ├── speech_to_text
    │   ├── russian_speech.txt # Текст, распознанный из файла russian_speech.wav.
    │   └── speech.txt # Текст, распознанный из файла speech.wav.
    └── speech_to_text_test.py # Скрипт для тестирования функции распознавания речи и преобразования в текст.

# Вывод 
Я разработал этот сервис по техническому заданию для вакансии ML-разработчика в компании Колл-Тулз, чтобы показать свои навыки в машинном обучении и создании API. Проект демонстрирует, как можно работать с моделями для распознавания речи и с обработкой аудио, и всё это собрано в удобное решение с использованием Docker.

Сейчас сервис использует готовые модели speechbrain и Vosk, но в дальнейшем их можно легко заменить на более точные или собственные модели. Это позволит улучшить качество распознавания речи и настроить сервис под конкретные задачи компании. Такой подход делает проект гибким и готовым к изменениям, если появятся новые требования или технологии в области аудио и распознавания речи.
